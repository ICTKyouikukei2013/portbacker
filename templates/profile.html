{% extends "layout.html" %}
{% block body %}
<div class="style">
  {% if show_tabs %}
  <div id="tabnavi">
    <div class="size">
      <div id="move_tab">
        <ul>
          <li class="tab tab-unsel"><a href="/">&nbsp;&nbsp;&nbsp;トップ&nbsp;&nbsp;&nbsp;</a></li>
          <li class="tab tab-unsel"><a href="portfolio">ポートフォリオ</a></li>
          <li class="tab tab-unsel"><a href="artifact">成果物管理</a></li>
          <li class="tab tab-unsel"><a href="person">個人日誌</a></li>
          <li class="tab tab-unsel"><a href="goal">ゴール設定</a></li>
          <li class="tab tab-special"><a href="profile">ユーザー情報</a></li>
        </ul>
      </div>
    </div>
  </div>
  {% else %}
  <div id="tabnavi">
    <div class="size">
      <div id="move_tab">
        <ul>
        <li>&nbsp;</li>
        </ul>
      </div>
    </div>
  </div>
  {% endif %}
  <div class="box">
    <div class="user"><h3>ユーザー情報編集</h3></div>
    <div class="border"></div>
    <div class="probox">
      <div class="userinfo">
        <form method="post" action="/profile">
          ユーザーID（学籍番号）&emsp;<input type="text" readonly="readonly" name="number_text" style="width:100px;" value="{{uid}}" />
          <br>
          名前&emsp;<input type="text" name="name" style="width:100px;" value="{{name}}" required autofocus/>
          <br>
          <!--
          <br> 
          パスワード&emsp;現在のパスワード
          <br>
          <input type="text" name="pass_text" style="width:100px;">
          <br>
          新しいパスワード
          <br>
          <input type="text" name="newpass_text" style="width:100px;">
          <br>
          再入力
          <br>
          <input type="text" name="pass_text" style="width:100px;">
          -->
          ユーザー種別&emsp;<SELECT name="user-type" id="user-type" required>
            <OPTION style="display:none"></OPTION>
            <OPTION value="0">学生</OPTION>
            <OPTION value="8">教員</OPTION>
            <OPTION value="9">職員</OPTION>
          </SELECT>
        <br>
        <div id="grade-box"> 
           学年&emsp;<SELECT name="grade" id="grade" required>
            <OPTION style="display:none"></OPTION>
            <OPTION value="1">B1</OPTION>
            <OPTION value="2">B2</OPTION>
            <OPTION value="3">B3</OPTION>
            <OPTION value="4">B4</OPTION>
            <OPTION value="5">M1</OPTION>
            <OPTION value="6">M2</OPTION>
            <option value="8" style="display:none"></option>
            <option value="9" style="display:none"></option>
          </SELECT>
          <br>
        </div>
        <div id="course-box"> 
            所属&emsp;<SELECT name="course" id="course" required placeholder="学年を選択してください">
            <OPTION style="display:none"></OPTION>
            <option value="8" style="display:none"></option>
            <option value="9" style="display:none"></option>
            </SELECT>
            <br>
         </div>
          <input type='submit' name="submit" class="btn-small btn-info">
          <input type="hidden" name="show_tabs" value="{{ show_tabs }}">
        </form>
      </div>
    </div>
  </div>
</div>
<script>
var set_visibilities_of_grade_and_course = function (userType) {
  $('#grade-box,#course-box').css('display', (userType == "8" || userType == "9") ? "none" : "block");
};

var couseOptionForB1 = [ ",none", "6,未配属", "8,none", "9,none" ];
var couseOptionForB2 = [ 
   ",none", "1,情報システムコース", "2,情報デザインコース", "3,複雑系知能コース",
   "4,複雑系コース",  "8,none", "9,none" 
];
var couseOptionForB34 = [ 
   ",none", "1,情報システムコース", "2,情報デザインコース", "3,複雑系知能コース",
   "4,複雑系コース", "5,高度ICTコース",  "8,none", "9,none" 
];
var courseOptionForM12 = [
   ",none", "1,情報アーキテクチャ領域", "2,メディアデザイン領域", "3,知能情報科学領域",
   "4,複雑系情報科学領域", "5,高度ICT領域",  "8,none", "9,none" 
];
var courseOptionForFacultyOrTeacher = [
   ",none", "8,none", "9,none"
]

var set_course_options = function(optionDefs) {
  $('#course option').remove();
  optionDefs.forEach(function (item) {
    var f = item.split(",");
    var value = f[0], text = f[1];
    if (text == "none") {
       $('#course').append($('<option>').html("").val(value).css("display", "none"));
    } else {
       $('#course').append($('<option>').html(text).val(value));
    }
  });
};

$(function() {
  $('#grade').val({{grade_index}});
  $('#course').val({{course_index}});
  var g = $('#grade').val();
  var ut = (g == "8" || g == "9") ? g : "0";
  $('#user-type').val(ut);
  
  set_visibilities_of_grade_and_course(ut);
  $('#user-type').on('change', function() {
    var ut = $('#user-type').val();
    set_visibilities_of_grade_and_course(ut);
    if (ut == "8" || ut == "9")
      $('#grade,#course').val(ut);
    else
      $('#grade,#course').val("0");
  });
  
  $('#grade').on('change', function() {
    var g = $('#grade').val();
    if (g == "1") {
      set_course_options(couseOptionForB1);
      $('#course').val("0");
    } else if (g == "2") {
      set_course_options(couseOptionForB2);
      $('#course').val("0");
    } else if (g == "3" || g == "4") {
      set_course_options(couseOptionForB34);
      $('#course').val("0");
    } else if ("5" <= g && g <= "6") {
      set_course_options(courseOptionForM12);
      $('#course').val("0");
    } else {
      set_course_options(courseOptionForFacultyOrTeacher);
      $('#course').val($('#user-type').val());
    }
  });
});
</script>
{% endblock %}
